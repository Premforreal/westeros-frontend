<div class="resort-detail-page">
  <div class="container-fluid p-0">
    <div *ngIf="loading" class="p-5 text-center">Loading property...</div>
    <div *ngIf="!loading && error" class="p-5 text-center text-danger">Property not found or failed to load.</div>
    <div *ngIf="!loading && property">
    <!-- Hero Section with Image Gallery -->
    <div class="resort-hero position-relative">
      <div class="main-image-wrapper">
        <img [src]="mainImage" [alt]="property?.name" class="main-image w-100">
        <div class="hero-overlay">
          <div class="container">
            <div class="hero-content">
              <span class="badge bg-primary mb-2">{{ property?.realm }}</span>
              <h1 class="resort-title text-white mb-2">{{ property?.name }}</h1>
              <div class="d-flex align-items-center text-white mb-2">
                <span class="rating-badge me-3" [ngClass]="getRatingClass(property?.rating || 0)">
                  {{ property?.rating }}
                </span>
                <span class="rating-text">{{ getRatingText(property?.rating || 0) }}</span>
                <span class="mx-2">‚Ä¢</span>
                <span>{{ property?.reviews?.length || 0 }} reviews</span>
              </div>
              <p class="location mb-0">üìç {{ property?.location }}</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Image Gallery Thumbnails -->
      <div class="container mt-3">
        <div class="row g-2">
          <div class="col-4 col-md-2" *ngFor="let image of (property?.galleryImages || []).slice(0,6)">
            <img [src]="image" alt="Resort gallery" class="gallery-thumb w-100 rounded"
                 (click)="setMainImage(image)"
                 [class.active]="mainImage === image"
                 style="cursor: pointer;">
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="container my-5">
      <div class="row">
        <!-- Left Column: Details -->
        <div class="col-lg-8">
          
          <!-- Property Highlights -->
          <section class="mb-5">
            <h2 class="section-title mb-4">Property Highlights</h2>
            <div class="row g-3">
              <div class="col-6 col-md-3" *ngFor="let feature of (property?.features || [])">
                <div class="facility-card text-center p-3 border rounded">
                  <div class="facility-icon fs-2 mb-2">üè∑Ô∏è</div>
                  <div class="facility-name small">{{ feature.category }}</div>
                </div>
              </div>
            </div>
          </section>

          <!-- About This Property -->
          <section class="mb-5">
            <h2 class="section-title mb-4">About This Property</h2>
            <div class="description-text">
              <p *ngFor="let paragraph of (property?.description || '').split('\n\n')">{{ paragraph }}</p>
            </div>
          </section>

          <!-- Most Popular Facilities -->
          <section class="mb-5">
            <h2 class="section-title mb-4">Most Popular Facilities</h2>
            <div class="row">
              <div class="col-md-6" *ngFor="let feat of (property?.features || [])">
                <div class="d-flex align-items-center mb-2">
                  <span class="text-success me-2">‚úì</span>
                  <span>{{ feat.amenities?.[0] || feat.category }}</span>
                </div>
              </div>
            </div>
          </section>

          <!-- Resort Features -->
          <section class="mb-5" id="features">
            <h2 class="section-title mb-4">Resort Features</h2>
            <div class="row g-4">
              <div class="col-12 col-md-6" *ngFor="let feature of (property?.features || [])">
                <div class="feature-card border rounded p-4">
                  <h4 class="feature-title mb-3">{{ feature.category }}</h4>
                  <p class="feature-description text-muted mb-3">{{ feature.description }}</p>
                  <div class="amenities">
                    <div class="row g-2">
                      <div class="col-6" *ngFor="let amenity of (feature.amenities || [])">
                        <div class="d-flex align-items-center">
                          <span class="text-success me-2">‚úì</span>
                          <span class="small">{{ amenity }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Guest Reviews -->
          <section class="mb-5">
            <h2 class="section-title mb-4">Guest Reviews</h2>
            
            <!-- Review Categories -->
            <div class="review-categories mb-4 p-4 bg-light rounded">
              <div class="row g-3">
                <div class="col-6 col-md-4" *ngFor="let category of (property?.reviewCategories || [])">
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="small">{{ category.name }}</span>
                    <span class="badge bg-primary">{{ category.score }}</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Individual Reviews -->
            <div class="reviews-list">
              <div class="review-card border rounded p-4 mb-3" *ngFor="let review of (property?.reviews || [])">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <div>
                    <h6 class="mb-1">{{ review.author }}</h6>
                    <small class="text-muted">{{ review.country }} ‚Ä¢ {{ review.date | date: 'MMM dd, yyyy' }}</small>
                  </div>
                  <div class="review-rating">
                    <span class="rating-badge" [ngClass]="getRatingClass(review.rating)">
                      {{ review.rating }}
                    </span>
                  </div>
                </div>
                <p class="review-comment mb-0">{{ review.comment }}</p>
              </div>
            </div>
          </section>

          <!-- Nearby Attractions -->
          <section class="mb-5">
            <h2 class="section-title mb-4">What's Nearby</h2>
            <div class="list-group">
              <div class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let attraction of (property?.nearbyAttractions || [])">
                <span>üèõÔ∏è {{ attraction.name }}</span>
                <span class="badge bg-secondary">{{ attraction.distance }}</span>
              </div>
            </div>
          </section>

          <!-- House Rules -->
          <section class="mb-5">
            <h2 class="section-title mb-4">House Rules</h2>
            <div class="house-rules p-4 border rounded">
              <div class="row g-3">
                <div class="col-md-6">
                  <strong>Check-in:</strong> From {{ property.policies.checkIn || '‚Äî' }}
                </div>
                <div class="col-md-6">
                  <strong>Check-out:</strong> Until {{ property.policies.checkOut || '‚Äî' }}
                </div>
                <div class="col-12">
                  <strong>Children:</strong> {{ property.policies.childrenPolicy || '‚Äî' }}
                </div>
                <div class="col-12">
                  <strong>Pets:</strong> {{ property.policies.petsPolicy || '‚Äî' }}
                </div>
                <div class="col-12">
                  <strong>Cancellation:</strong> {{ property.policies.cancellationPolicy || '‚Äî' }}
                </div>
              </div>
            </div>
          </section>

        </div>

        <!-- Right Column: Booking Card -->
        <div class="col-lg-4">
          <div class="booking-card sticky-top">
            <div class="card shadow-lg border-0">
              <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h3 class="mb-0">Book Your Stay</h3>
                  <span class="price-badge h4 text-primary mb-0">‚Çπ{{ property?.priceFrom | number }}</span>
                </div>
                <p class="text-muted small mb-4">per night</p>

                <!-- Date Selection -->
                <div class="mb-3">
                  <label class="form-label fw-semibold">Select Dates</label>
                  <mat-form-field appearance="outline" class="w-100 search-date-field">
                    <mat-date-range-input [rangePicker]="picker" [min]="minCheckInDate">
                      <input matStartDate placeholder="Check-in" name="start" 
                             [(ngModel)]="checkInDate" 
                             (dateChange)="onCheckInDateChange()" 
                             (click)="picker.open()" 
                             (focus)="picker.open()">
                      <input matEndDate placeholder="Check-out" name="end" 
                             [(ngModel)]="checkOutDate" 
                             [min]="minCheckOutDate" 
                             (dateChange)="onCheckOutDateChange()"
                             (click)="picker.open()" 
                             (focus)="picker.open()">
                    </mat-date-range-input>
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <button type="button" mat-icon-button matSuffix (click)="clearDates()" *ngIf="checkInDate || checkOutDate" title="Clear dates">
                      <span class="small">‚úï</span>
                    </button>
                    <mat-date-range-picker #picker></mat-date-range-picker>
                  </mat-form-field>
                </div>

                <div class="mb-4">
                  <label class="form-label fw-semibold">Guests</label>
                  <input type="number" class="form-control" 
                         [(ngModel)]="guests" min="1" max="12">
                </div>

                <!-- Pricing Info -->
                <div class="price-info mb-3 p-3 bg-light rounded">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <div class="fw-bold">Base Rate</div>
                    <div>‚Çπ{{ property?.priceFrom | number }} / night</div>
                  </div>
                  
                  <ng-container *ngIf="numberOfNights > 0">
                    <hr class="my-2">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <div class="small">Number of Nights</div>
                      <div class="small">√ó {{ numberOfNights }}</div>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center">
                      <div class="fw-bold">Total</div>
                      <div class="text-primary h4 mb-0">‚Çπ{{ totalPrice | number }}</div>
                    </div>
                    
                    <div class="small text-muted mt-2">
                      Includes all resort amenities and taxes
                    </div>
                  </ng-container>
                </div>

                <button class="btn btn-primary btn-lg w-100 mb-3" 
                        (click)="bookNow()"
                        [disabled]="!checkInDate || !checkOutDate">
                  Book Resort Stay
                </button>

                <div class="text-center">
                  <small class="text-muted">
                    <span class="text-success">‚úì</span> Free cancellation up to 48 hours
                  </small>
                </div>
              </div>
            </div>

            <!-- Trust Badges -->
            <div class="trust-badges mt-3 p-3 bg-light rounded">
              <div class="small text-center mb-2 fw-semibold">Why Book With Us?</div>
              <div class="d-flex flex-column gap-2">
                <div class="small">‚úì Best Price Guarantee</div>
                <div class="small">‚úì Secure Payment</div>
                <div class="small">‚úì 24/7 Customer Support</div>
                <div class="small">‚úì Instant Confirmation</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
