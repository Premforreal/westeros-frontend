# Multi-Project Angular Configuration Guide

This document explains how to configure multiple projects (like PropToll and Cosyn) within a single Angular workspace using build configurations and file replacements.

## Overview

The project uses a single Angular workspace with one main project (`proptoll`) that can be built for different products using Angular CLI configurations. Each product has its own:

- Environment files (API URLs, Sentry DSN, Matomo tracking)
- Menu configuration
- Product-specific settings (branding, logos, features)
- Service configurations

## Project Structure

```
src/
├── environments/
│   ├── proptoll/
│   │   ├── environment.development.ts
│   │   ├── environment.production.ts
│   │   ├── environment.qa.ts
│   │   └── environment.staging.ts
│   └── cosyn/
│       ├── environment.development.ts
│       ├── environment.production.ts
│       ├── environment.qa.ts
│       └── environment.staging.ts
├── product-configurations/
│   ├── proptoll-config.ts
│   ├── cosyn-config.ts
│   ├── product-config.ts (base config)
│   └── product-selection.ts (runtime product selection)
├── app/menu/
│   ├── proptoll-menu.ts
│   ├── cosyn-menu.ts
│   └── menu.ts (base menu)
└── services/network/
    ├── http-stream/ (shared services)
    └── cosyn/
        └── http-stream/ (cosyn-specific services)
```

## Configuration Files

### 1. Product Selection (`product-selection.ts`)

This file is dynamically generated by npm scripts to set the current product:

```typescript
export const PRODUCT = "proptoll"; // or "cosyn"
```

### 2. Product Configurations

Each product has its own configuration file:

**proptoll-config.ts:**
```typescript
export const PRODUCT_CONFIG: ProductConfig = {
    appName: 'PropToll',
    appTitle: 'PropToll',
    faviconUrl: 'assets/favicons/proptoll.ico',
    appLogoImage: 'assets/images/logo/logo_proptoll.png',
    appLanguage: 'en',
    loginPageImage: 'assets/images/pages/graphic-2.png',
    loginPageUrl: 'authentication/login-v2'
}
```

**cosyn-config.ts:**
```typescript
export const PRODUCT_CONFIG: ProductConfig = {
    appName: 'digiLikhat',
    appTitle: 'digiLikhat',
    faviconUrl: 'assets/favicons/cosyn.ico',
    appLogoImage: 'assets/images/logo/logo_cosyn.png',
    appLanguage: 'en',
    loginPageImage: 'assets/images/pages/graphic-1.png',
    loginPageUrl: 'authentication/login-v1'
}
```

### 3. Environment Files

Each product has separate environment configurations:

**PropToll Production:**
```typescript
export const environment = {
  name: 'production',
  type: ENVIRONMENT_TYPE.PRODUCTION,
  apiUrl: 'https://api.proptoll.com/api',
  sentryDsn: 'https://fcd42582d2834f99a76b5df6026edf61@...',
  matomoConfig: {
    siteId: 1,
    // ...
  }
};
```

**Cosyn Production:**
```typescript
export const environment = {
  name: 'production',
  type: ENVIRONMENT_TYPE.PRODUCTION,
  apiUrl: 'https://api.cosyn.metapointer.com',
  sentryDsn: 'https://6ca6d98b063055526a6aaa1a2198ecf1@...',
  matomoConfig: {
    siteId: 2,
    // ...
  }
};
```

## Angular Configuration (`angular.json`)

### Build Configurations

The `angular.json` defines build configurations for each product and environment:

```json
{
  "projects": {
    "proptoll": {
      "architect": {
        "build": {
          "configurations": {
            "proptoll-production": {
              "fileReplacements": [
                {
                  "replace": "src/environments/environment.ts",
                  "with": "src/environments/proptoll/environment.production.ts"
                },
                {
                  "replace": "src/app/menu/menu.ts",
                  "with": "src/app/menu/proptoll-menu.ts"
                },
                {
                  "replace": "src/product-configurations/product-config.ts",
                  "with": "src/product-configurations/proptoll-config.ts"
                }
              ]
            },
            "cosyn-production": {
              "fileReplacements": [
                {
                  "replace": "src/environments/environment.ts",
                  "with": "src/environments/cosyn/environment.production.ts"
                },
                {
                  "replace": "src/app/menu/menu.ts",
                  "with": "src/app/menu/cosyn-menu.ts"
                },
                {
                  "replace": "src/product-configurations/product-config.ts",
                  "with": "src/product-configurations/cosyn-config.ts"
                }
              ]
            }
          }
        }
      }
    }
  }
}
```

### Serve Configurations

Serve configurations map to build configurations:

```json
{
  "serve": {
    "configurations": {
      "proptoll-development": {
        "buildTarget": "proptoll:build:proptoll-development"
      },
      "cosyn-development": {
        "buildTarget": "proptoll:build:cosyn-development"
      }
    }
  }
}
```

## NPM Scripts (`package.json`)

### Product Selection Scripts

Scripts dynamically set the product before running Angular CLI commands:

```json
{
  "scripts": {
    "serve-dev": "echo export const PRODUCT = \"proptoll\"; > src/product-configurations/product-selection.ts && ng serve --configuration=proptoll-development --open",
    "serve-dev-cosyn": "echo export const PRODUCT = \"cosyn\"; > src/product-configurations/product-selection.ts && ng serve --configuration=cosyn-development --open",
    "build:prod": "ng build --configuration=proptoll-production",
    "build:prod:cosyn": "ng build --configuration=cosyn-production"
  }
}
```

## Menu Configurations

### PropToll Menu (`proptoll-menu.ts`)

Extensive menu with property management features:
- Dashboard analytics
- Property management
- Visitor management
- Reports and analytics
- Admin features

### Cosyn Menu (`cosyn-menu.ts`)

Education-focused menu:
- Dashboard
- Subjects management
- Students management
- Invigilators management
- Classroom management

## Service Architecture

### Shared Services

Located in `src/services/network/http-stream/`:
- Common API services
- Base service classes
- Shared models and configurations

### Product-Specific Services

Located in `src/services/network/{product}/http-stream/`:
- Product-specific API endpoints
- Custom service implementations
- Product-specific models

## How to Add a New Product

1. **Create Product Directory Structure:**
   ```
   src/environments/{new-product}/
   src/services/network/{new-product}/
   ```

2. **Create Configuration Files:**
   - `src/product-configurations/{new-product}-config.ts`
   - `src/app/menu/{new-product}-menu.ts`

3. **Create Environment Files:**
   - `src/environments/{new-product}/environment.{environment}.ts`

4. **Update angular.json:**
   - Add new build configurations with file replacements
   - Add serve configurations

5. **Update package.json:**
   - Add npm scripts for the new product

6. **Update Product Selection Logic:**
   - Modify any conditional logic that checks the PRODUCT constant

## Runtime Product Detection

The application uses the `PRODUCT` constant from `product-selection.ts` to:

1. Load the correct product configuration
2. Display appropriate branding
3. Show product-specific menus
4. Configure environment-specific settings

## Build Process

When building for a specific product:

1. Angular CLI replaces files based on configuration
2. Product selection file is updated
3. Environment files are swapped
4. Menu files are replaced
5. Product config files are replaced
6. Build outputs to `dist/proptoll/` (same output directory)

## Benefits of This Approach

- **Single Codebase:** Maintain one codebase for multiple products
- **Shared Components:** Reuse common components and services
- **Environment Isolation:** Separate API endpoints and configurations
- **Build Optimization:** Tree-shaking removes unused code
- **Easy Deployment:** Different build commands for different products

## Development Workflow

### For PropToll Development:
```bash
npm run serve-dev
```

### For Cosyn Development:
```bash
npm run serve-dev-cosyn
```

### For Production Builds:
```bash
npm run build:prod      # PropToll production
npm run build:prod:cosyn # Cosyn production
```

This configuration allows you to maintain feature parity while customizing each product for its specific use case, whether it's property management (PropToll) or education management (Cosyn).</content>
<parameter name="filePath">c:\Users\Metapointer\Desktop\Projects\hms-frontend\full-version\multi-project-configuration-guide.md